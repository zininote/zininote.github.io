---
layout: post
title: "VLOOKUP: 느린 검색 속도를 빠르게 개선하는 함수식"
updated: 2021-01-22
tags: [msoffice,excel]
---

## VLOOKUP 속도가 느려지는 경우

보통 VLOOKUP 함수는, 4번째 인수를 FALSE 로 두어 "정확한일치검색" 방식으로 주로 사용하는데, 이 방식은 검색해야할 대상이 많고 VLOOKUP 함수가 매우 많이 쓰일 땐, 계산 속도가 상당히 느려지는 단점을 보인다.

이 포스팅에서는 VLOOKUP 함수 사용법을 살짝 바꾸는 방식만으로, 검색속도를 획기적으로 개선할 수 있는 방법을 소개한다.

## 속도 개선 VLOOKUP 함수식

```excel
= IF(VLOOKUP(검색값, 검색범위, 1, TRUE) = 검색값, VLOOKUP(검색값, 검색범위, 열번호, TRUE), NA())
```
{:.excel}

검색기준열이 되는 `검색범위`의 가장 왼쪽열은 반드시 **오름차순으로 정렬**되어있어야 정상작동 한다.

![그림00](/img/msoffice/excel-4403-01-01-00.png)

VLOOKUP 함수를 두번 사용하였다. 그리고 VLOOKUP 함수의 4번째 인수에는 TRUE 가 사용되었는데, 이는 "유사일치검색"을 사용하겠다는 의미다.

"유사일치검색"은 데이터를 순차적으로 검색하지 않는다. 먼저 데이터에서 중간값을 찾아 `검색값`과 비교한다. 중간값 < `검색값`이라면 그보다 위쪽, 아니라면 그보다 아래쪽 데이터의 중간값을 다시 찾아 `검색값`과 다시 비교한다. 이 특징을 제대로 살리기 위해 `검색범위`의 가장 왼쪽열이 오름차순으로 정렬이 되어 있어야 한다. 만일 데이터 중간에 새로운 값을 삽입했다면, 다시 오름차순으로 정렬해줘야 오작동을 방지할 수 있다.

얼마나 빠를까? 데이터가 10000개 있다고 해보자. VLOOKUP "정확한일치검색"으로는 최대 10000번 검색을 하게 된다. 하지만 "유사일치검색" 방식은 아무리 많아봐야 14번 검색만 하면 된다.

그리고 VLOOKUP 이 두번쓰인 이유는 "유사일치검색"은 `검색값`과 정확하게 일치하는 데이터가 없어도 에러를 발생시키지않고 바로 근처의 값을 반환한다. 이를 IF 와 NA 함수로 보완하여 "유사일치검색"을 "정확한일치검색" 처럼 작동하도록 만든 것이다.